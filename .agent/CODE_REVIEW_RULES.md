# Code Review Rules (Self-Correction)

**每次代码审查前必须审阅本文件。**

## 核心原则

### 1. 追踪完整调用链 ✅
- **禁止**：仅根据函数定义判断是否有问题
- **必须**：使用 `grep_search` 追踪所有调用点
- **必须**：确认初始化路径（可能不在当前文件）

### 2. 验证数据来源 ✅
- **禁止**：假设空函数是遗漏逻辑
- **必须**：检查数据是否在其他地方已采集/更新
- **示例**：`TempResultTask` 空实现 → 实际上温度在 ADC 中断已采集

### 3. 追踪对象初始化 ✅
- **禁止**：假设指针可能为 NULL 就是"风险"
- **必须**：确认对象初始化来源和保证
- **示例**：`encoder` 指针在 `Control_Init()` 中保证初始化

### 4. 区分"死代码"和"初始化分离" ✅
- 嵌入式项目常见模式：初始化在单独文件（如 `robot.c`）
- 不要假设"这里没调用"就等于"系统有 bug"

## 检查清单

在代码审查时，按顺序执行：

1. [ ] grep 搜索函数/变量的所有使用点
2. [ ] 追踪 `*_Init` 函数调用链
3. [ ] 确认数据流（谁写、谁读、频率）
4. [ ] 验证对象生命周期（何时创建、是否可能为 NULL）
5. [ ] 如有怀疑，先验证再报告

## 算法审查规则 (新增)

### 5. 审查算法前必须追踪上下游 ✅
- **禁止**：只看当前函数就判断系数/公式对错
- **必须**：先查上游输入来源、下游输出去向
- **示例**：审查 SVPWM 归一化系数前，先看 Clarke 变换实现

### 6. 不确定时说"需要验证"而非"可能有问题" ✅
- **禁止**：用"需验证"暗示有问题
- **必须**：如果不确定，明确说"我不确定，让我先追踪"
- **禁止**：用户追问后临时编造理由

---

*Last Updated: 2026-02-05*
